{{/* 自定义 Head 扩展
     此文件的内容会被添加到页面的 <head> 标签中
     文档: https://github.com/adityatelange/hugo-PaperMod/wiki/FAQs#custom-head--footer
*/}}

{{/* ======== 性能优化 ======== */}}

{{/* DNS 预解析 - 加速外部资源加载 (针对中国大陆优化) */}}
<link rel="dns-prefetch" href="//jsd.cdn.zzko.cn">
<link rel="dns-prefetch" href="//pl.kkkk24juastin.asia">
<link rel="dns-prefetch" href="//cubism.live2d.com">

{{/* 预连接 - 提前建立 Twikoo 评论和 CDN 连接 */}}
<link rel="preconnect" href="https://jsd.cdn.zzko.cn" crossorigin>
<link rel="preconnect" href="https://pl.kkkk24juastin.asia" crossorigin>

{{/* 资源优先级提示 - 告诉浏览器优先加载关键资源 */}}
{{/* 首页和列表页预取下一页 */}}
{{ if .IsHome }}
{{ range first 3 (where .Site.RegularPages "Type" "posts") }}
<link rel="prefetch" href="{{ .RelPermalink }}" as="document">
{{ end }}
{{ end }}

{{/* fetchpriority 提示 - 已经由主题的 CSS 预加载处理 */}}

{{/* 图片懒加载脚本 - 使用原生 loading="lazy" 属性 */}}
<script>
  // 为所有图片添加懒加载属性和渐显效果
  document.addEventListener('DOMContentLoaded', function() {
    // 图片加载完成后添加 loaded 类以显示渐显效果
    function addLoadedClass(img) {
      if (img.complete) {
        img.classList.add('loaded');
      } else {
        img.addEventListener('load', function() {
          img.classList.add('loaded');
        });
        img.addEventListener('error', function() {
          img.classList.add('loaded'); // 加载失败也显示
        });
      }
    }
    
    // 为文章内的图片添加懒加载
    document.querySelectorAll('.post-content img').forEach(function(img) {
      if (!img.hasAttribute('loading')) {
        img.setAttribute('loading', 'lazy');
        img.setAttribute('decoding', 'async');
      }
      addLoadedClass(img);
    });
    
    // 为封面图片添加懒加载（首屏封面除外）
    document.querySelectorAll('.entry-cover img').forEach(function(img, index) {
      // 首页第一张封面不懒加载
      if (index > 0) {
        if (!img.hasAttribute('loading')) {
          img.setAttribute('loading', 'lazy');
          img.setAttribute('decoding', 'async');
        }
      }
      addLoadedClass(img);
    });
  });
</script>

{{/* ======== 其他自定义设置 ======== */}}

{{/* 可以在这里添加自定义的 meta 标签、CSS、JavaScript 等 */}}

{{/* 示例: 添加自定义字体 */}}
{{/* <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet"> */}}

{{/* 示例: 添加自定义 meta 标签 */}}
{{/* <meta name="keywords" content="your,keywords,here"> */}}
