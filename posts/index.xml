<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Posts on kkkk24 çš„åšå®¢</title>
    <link>https://blog.kkkk24juastin.asia/posts/</link>
    <description>Recent content in Posts on kkkk24 çš„åšå®¢</description>
    <generator>Hugo -- 0.155.2</generator>
    <language>zh-cn</language>
    <lastBuildDate>Fri, 06 Feb 2026 00:00:00 +0000</lastBuildDate>
    <atom:link href="https://blog.kkkk24juastin.asia/posts/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>èŠèŠè¿™ä¸ªåšå®¢æ˜¯æ€ä¹ˆè·‘èµ·æ¥çš„</title>
      <link>https://blog.kkkk24juastin.asia/posts/hugo-blog-architecture/</link>
      <pubDate>Wed, 04 Feb 2026 00:00:00 +0000</pubDate>
      <guid>https://blog.kkkk24juastin.asia/posts/hugo-blog-architecture/</guid>
      <description>è®°å½•ä¸€ä¸‹åšå®¢ä»å†™æ–‡ç« åˆ°ä¸Šçº¿çš„å…¨è¿‡ç¨‹ï¼Œæ¶‰åŠ Hugoã€GitHub Actionsã€æœåŠ¡å™¨éƒ¨ç½²å’Œ CDN åŠ é€Ÿ</description>
      <content:encoded><![CDATA[<p>æœ€è¿‘æŠŠåšå®¢ä» Hexo æ¢æˆäº† Hugoï¼Œé¡ºä¾¿é‡æ–°è®¾è®¡äº†ä¸€ä¸‹æ„å»ºå’Œéƒ¨ç½²æµç¨‹ã€‚è¶çƒ­ä¹è®°å½•ä¸€ä¸‹ï¼Œä¹Ÿæ–¹ä¾¿ä»¥åè‡ªå·±æŸ¥ã€‚</p>
<h2 id="å…ˆè¯´ç»“è®ºæ•´ä½“æµç¨‹">å…ˆè¯´ç»“è®ºï¼šæ•´ä½“æµç¨‹</h2>
<p>ç®€å•æ¥è¯´å°±æ˜¯è¿™ä¹ˆä¸ªäº‹å„¿ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">æˆ‘å†™ Markdown â†’ æ¨åˆ° GitHub â†’ Actions è‡ªåŠ¨ç¼–è¯‘ â†’ æœåŠ¡å™¨æ‹‰å– â†’ Cloudflare åŠ é€Ÿ
</span></span></code></pre></div><p>ç”»ä¸ªå›¾æ›´æ¸…æ¥šï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">æœ¬åœ°å†™æ–‡ç«  (Markdown)
</span></span><span class="line"><span class="cl">        â†“ git push
</span></span><span class="line"><span class="cl">GitHub main åˆ†æ”¯
</span></span><span class="line"><span class="cl">        â†“ è§¦å‘ Actions
</span></span><span class="line"><span class="cl">GitHub Actions ç¼–è¯‘
</span></span><span class="line"><span class="cl">        â†“ ç”Ÿæˆé™æ€æ–‡ä»¶
</span></span><span class="line"><span class="cl">gh-pages åˆ†æ”¯
</span></span><span class="line"><span class="cl">        â†“ æœåŠ¡å™¨ git pull
</span></span><span class="line"><span class="cl">Nginx æ‰˜ç®¡é™æ€æ–‡ä»¶
</span></span><span class="line"><span class="cl">        â†“ 
</span></span><span class="line"><span class="cl">Cloudflare CDN ç¼“å­˜åŠ é€Ÿ
</span></span><span class="line"><span class="cl">        â†“
</span></span><span class="line"><span class="cl">ç”¨æˆ·è®¿é—®
</span></span></code></pre></div><p>ä¸ºå•¥è¦æè¿™ä¹ˆå¤æ‚ï¼Ÿä¸»è¦æ˜¯ä¸æƒ³æ¯æ¬¡æ”¹ä¸ªé”™åˆ«å­—éƒ½è¦ç™»æœåŠ¡å™¨æ‰‹åŠ¨æ“ä½œã€‚</p>
<h2 id="ä¸ºå•¥é€‰-hugo">ä¸ºå•¥é€‰ Hugo</h2>
<p>ä¹‹å‰ç”¨çš„ Hexoï¼Œæ²¡å•¥å¤§æ¯›ç—…ï¼Œä½†æœ‰å‡ ä¸ªç—’ç‚¹ï¼š</p>
<ol>
<li><strong>npm ä¾èµ–å¤ªå¤šäº†</strong>ã€‚æ¯æ¬¡ CI å…‰è£…ä¾èµ–å°±å¾—å¥½ä¸€ä¼šå„¿ï¼Œå¶å°”è¿˜ä¼šå‡ºç‚¹ç‰ˆæœ¬å†²çªçš„å¹ºè›¾å­</li>
<li><strong>æœ¬åœ°é¢„è§ˆæ…¢</strong>ã€‚æ–‡ç« å¤šäº†ä¹‹åï¼Œçƒ­æ›´æ–°æ˜æ˜¾å˜å¡</li>
<li><strong>æƒ³å°å°é²œ</strong>ã€‚Hugo ç”¨ Go å†™çš„ï¼Œæ®è¯´å¿«å¾—ç¦»è°±</li>
</ol>
<p>å®é™…ç”¨ä¸‹æ¥ï¼Œç¡®å®å¿«ã€‚æœ¬åœ°é¢„è§ˆåŸºæœ¬ç§’å¼€ï¼ŒGitHub Actions é‚£è¾¹æ„å»ºä¹Ÿå°±å‡ ç§’é’Ÿçš„äº‹ã€‚</p>
<h2 id="github-actionsè‡ªåŠ¨åŒ–æ„å»º">GitHub Actionsï¼šè‡ªåŠ¨åŒ–æ„å»º</h2>
<p>è¿™æ˜¯æ•´å¥—æµç¨‹çš„æ ¸å¿ƒã€‚é…ç½®æ–‡ä»¶åœ¨ <code>.github/workflows/hugo.yml</code>ï¼Œåšçš„äº‹æƒ…ä¹Ÿç®€å•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Build Hugo Site</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nt">on</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">push</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="l">main]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nt">jobs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">build</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l">ubuntu-latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">steps</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">è£… Hugo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">          wget -O hugo.deb https://github.com/gohugoio/hugo/releases/...
</span></span></span><span class="line"><span class="cl"><span class="sd">          sudo dpkg -i hugo.deb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">æ‹‰ä»£ç </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">actions/checkout@v4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">with</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">submodules</span><span class="p">:</span><span class="w"> </span><span class="l">recursive </span><span class="w"> </span><span class="c"># ä¸»é¢˜æ˜¯ submodule</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ç¼–è¯‘</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l">hugo --gc --minify</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">æ¨åˆ° gh-pages</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">peaceiris/actions-gh-pages@v4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">with</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">publish_dir</span><span class="p">:</span><span class="w"> </span><span class="l">./public</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">publish_branch</span><span class="p">:</span><span class="w"> </span><span class="l">gh-pages</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">é¡ºæ‰‹æ¸…ä¸€ä¸‹ CDN ç¼“å­˜</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l">curl -X POST &#34;https://api.cloudflare.com/...&#34; ...</span><span class="w">
</span></span></span></code></pre></div><p>æ¯æ¬¡ push åˆ° main åˆ†æ”¯ï¼ŒActions å°±è‡ªåŠ¨è·‘è¿™ä¸€å¥—ã€‚æˆåŠŸä¹‹åï¼Œç¼–è¯‘å¥½çš„é™æ€æ–‡ä»¶å°±èººåœ¨ gh-pages åˆ†æ”¯é‡Œäº†ã€‚</p>
<h2 id="åŒåˆ†æ”¯ç­–ç•¥">åŒåˆ†æ”¯ç­–ç•¥</h2>
<p>è¿™ä¸ªè®¾è®¡æˆ‘æŒºæ»¡æ„çš„ï¼š</p>
<ul>
<li><strong>main åˆ†æ”¯</strong>ï¼šæºä»£ç ï¼ŒMarkdown æ–‡ä»¶ + ä¸»é¢˜é…ç½®</li>
<li><strong>gh-pages åˆ†æ”¯</strong>ï¼šç¼–è¯‘äº§ç‰©ï¼Œçº¯é™æ€æ–‡ä»¶</li>
</ul>
<p>å¥½å¤„æ˜¯æœåŠ¡å™¨ä¸Šä¸ç”¨è£… Hugoï¼Œç›´æ¥æ‹‰ gh-pages å°±èƒ½ç”¨ã€‚ä¸‡ä¸€å“ªå¤©æƒ³æ¢ä¸ªéƒ¨ç½²æ–¹å¼ï¼Œä¹Ÿæ–¹ä¾¿ã€‚</p>
<h2 id="æœåŠ¡å™¨è¿™è¾¹">æœåŠ¡å™¨è¿™è¾¹</h2>
<p>æœåŠ¡å™¨å°±åšä¸¤ä»¶äº‹ï¼š</p>
<ol>
<li>å®šæ—¶ï¼ˆæˆ–æ‰‹åŠ¨ï¼‰ä» gh-pages æ‹‰æœ€æ–°çš„é™æ€æ–‡ä»¶</li>
<li>Nginx ä¼ºå€™ç€</li>
</ol>
<p>Nginx é…ç½®æ²¡å•¥ç‰¹åˆ«çš„ï¼Œä¸»è¦æ˜¯åŠ äº†ç‚¹ç¼“å­˜å’Œå‹ç¼©ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server_name</span> <span class="s">blog.kkkk24juastin.asia</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">root</span> <span class="s">/var/www/blog</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># å‹ç¼©
</span></span></span><span class="line"><span class="cl">    <span class="kn">gzip</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">gzip_types</span> <span class="s">text/css</span> <span class="s">application/javascript</span> <span class="s">text/html</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># é™æ€èµ„æºç¼“å­˜ä¹…ä¸€ç‚¹
</span></span></span><span class="line"><span class="cl">    <span class="kn">location</span> <span class="p">~</span><span class="sr">*</span> <span class="s">\.(css|js|png|jpg|woff2)</span>$ <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">expires</span> <span class="s">1y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">add_header</span> <span class="s">Cache-Control</span> <span class="s">&#34;public,</span> <span class="s">immutable&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>æ›´æ–°è„šæœ¬ä¹Ÿå°±å‡ è¡Œï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="nb">cd</span> /var/www/blog
</span></span><span class="line"><span class="cl">git fetch origin gh-pages
</span></span><span class="line"><span class="cl">git reset --hard origin/gh-pages
</span></span></code></pre></div><p>æ‰” crontab é‡Œå®šæ—¶è·‘ï¼Œæˆ–è€…é…ä¸ª webhook è§¦å‘éƒ½è¡Œã€‚</p>
<h2 id="cloudflare-åŠ é€Ÿ">Cloudflare åŠ é€Ÿ</h2>
<p>æœ€åæŒ‚äº†å±‚ Cloudflareï¼Œä¸»è¦å›¾å‡ ä¸ªå¥½å¤„ï¼š</p>
<ol>
<li><strong>å…¨çƒ CDN</strong>ã€‚è®¿å®¢èƒ½ä»å°±è¿‘èŠ‚ç‚¹æ‹¿ç¼“å­˜ï¼Œä¸ç”¨æ¯æ¬¡éƒ½å›æº</li>
<li><strong>å…è´¹ SSL</strong>ã€‚æ‡’å¾—è‡ªå·±æŠ˜è…¾è¯ä¹¦</li>
<li><strong>DDoS é˜²æŠ¤</strong>ã€‚è™½ç„¶æˆ‘è¿™å°ç ´ç«™åº”è¯¥æ²¡äººä¼šæ‰“</li>
</ol>
<p>ä¸è¿‡æœ‰ä¸ªå‘ï¼šCloudflare é»˜è®¤ä¸ç¼“å­˜ HTML é¡µé¢ã€‚å¯¹äºé™æ€åšå®¢æ¥è¯´è¿™å¤ªäºäº†ï¼Œå¾—æ‰‹åŠ¨åŠ ä¸ª Cache Ruleï¼Œè®©å®ƒæŠŠ HTML ä¹Ÿç¼“å­˜ä¸Šã€‚</p>
<p>é…ç½®å¥½ä¹‹åï¼Œè®¿é—®é€Ÿåº¦ä»ä¹‹å‰çš„ 2 ç§’å¤šé™åˆ°äº†å‡ åæ¯«ç§’ï¼Œæ•ˆæœç«‹ç«¿è§å½±ã€‚</p>
<h2 id="å®é™…æ•ˆæœ">å®é™…æ•ˆæœ</h2>
<p>ä¼˜åŒ–å‰åçš„å¯¹æ¯”ï¼š</p>
<table>
  <thead>
      <tr>
          <th>æŒ‡æ ‡</th>
          <th>ä¹‹å‰</th>
          <th>ç°åœ¨</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>é¦–å­—èŠ‚æ—¶é—´ (TTFB)</td>
          <td>2.28s</td>
          <td>~50ms</td>
      </tr>
      <tr>
          <td>é¡µé¢åŠ è½½</td>
          <td>3.5s</td>
          <td>0.8s</td>
      </tr>
  </tbody>
</table>
<p>ä¸»è¦æå‡æ¥è‡ª CDN ç¼“å­˜ã€‚ä»£ç å±‚é¢å…¶å®å·²ç»æ²¡å•¥å¯ä¼˜åŒ–çš„äº†ï¼Œç“¶é¢ˆéƒ½åœ¨ç½‘ç»œå»¶è¿Ÿã€‚</p>
<h2 id="ä¸€äº›ç¢ç¢å¿µ">ä¸€äº›ç¢ç¢å¿µ</h2>
<p>æ•´å¥—æµç¨‹è·‘ä¸‹æ¥ï¼Œæœ€çˆ½çš„æ˜¯çœŸçš„ä¸ç”¨æ“å¿ƒéƒ¨ç½²äº†ã€‚å†™å®Œæ–‡ç« ï¼Œcommit + pushï¼Œç­‰ä¸ªå‡ åç§’ï¼Œåˆ·æ–°é¡µé¢å°±èƒ½çœ‹åˆ°æ›´æ–°ã€‚</p>
<p>å½“ç„¶ä¹Ÿæœ‰ä¸çˆ½çš„åœ°æ–¹ã€‚Hugo çš„æ¨¡æ¿è¯­æ³•ï¼ˆGo Templateï¼‰ç”¨èµ·æ¥ä¸å¤ªé¡ºæ‰‹ï¼Œæ–‡æ¡£ä¹Ÿæ¯”è¾ƒæ•£ã€‚ä¸è¿‡å¿å¿å°±å¥½ï¼Œæ¯•ç«Ÿä¸»é¢˜é…å¥½äº†åŸºæœ¬ä¸ç”¨æ”¹ã€‚</p>
<p>å¦‚æœä½ ä¹Ÿåœ¨æŠ˜è…¾åšå®¢ï¼Œå¸Œæœ›è¿™ç¯‡èƒ½æœ‰ç‚¹å¸®åŠ©ã€‚æœ‰é—®é¢˜å¯ä»¥ç•™è¨€ï¼Œçœ‹åˆ°ä¼šå›çš„ ğŸ‘‹</p>
]]></content:encoded>
    </item>
    <item>
      <title>åšå®¢åŠ è½½å¤ªæ…¢ï¼Ÿæˆ‘æ˜¯è¿™æ ·æ’æŸ¥å’Œè§£å†³çš„</title>
      <link>https://blog.kkkk24juastin.asia/posts/hugo-blog-speed-optimization-v2/</link>
      <pubDate>Fri, 06 Feb 2026 00:00:00 +0000</pubDate>
      <guid>https://blog.kkkk24juastin.asia/posts/hugo-blog-speed-optimization-v2/</guid>
      <description>å‘ç°åšå®¢é¦–é¡µåŠ è½½è¦ 2 ç§’å¤šï¼Œä¸€é¡¿æ’æŸ¥ä¹‹åæ‰¾åˆ°äº†ç½ªé­ç¥¸é¦–</description>
      <content:encoded><![CDATA[<h2 id="èµ·å› ">èµ·å› </h2>
<p>å‰ä¸¤å¤©è§‰å¾—åšå®¢æ‰“å¼€æœ‰ç‚¹æ…¢ï¼Œä½†ä¹Ÿæ²¡å¤ªåœ¨æ„ã€‚ä»Šå¤©é—²ç€æ²¡äº‹ï¼Œæ‹¿ curl æµ‹äº†ä¸€ä¸‹ï¼Œå¥½å®¶ä¼™ï¼Œé¦–å­—èŠ‚æ—¶é—´ï¼ˆTTFBï¼‰å±…ç„¶è¦ 2.28 ç§’ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -s -o /dev/null -w <span class="s2">&#34;TTFB: %{time_starttransfer}s\n&#34;</span> https://blog.kkkk24juastin.asia/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¾“å‡ºï¼šTTFB: 2.280466s</span>
</span></span></code></pre></div><p>è¿™ä¹Ÿå¤ªç¦»è°±äº†ã€‚æ˜æ˜æŒ‚ç€ Cloudflare CDNï¼Œæ€ä¹ˆè¿˜è¿™ä¹ˆæ…¢ï¼Ÿ</p>
<h2 id="æ’æŸ¥è¿‡ç¨‹">æ’æŸ¥è¿‡ç¨‹</h2>
<p>å…ˆçœ‹çœ‹å“åº”å¤´ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -sI https://blog.kkkk24juastin.asia/ <span class="p">|</span> grep -i cache
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¾“å‡ºï¼š</span>
</span></span><span class="line"><span class="cl"><span class="c1"># cf-cache-status: DYNAMIC</span>
</span></span><span class="line"><span class="cl"><span class="c1"># cache-control: max-age=3600</span>
</span></span></code></pre></div><p>çœ‹åˆ° <code>cf-cache-status: DYNAMIC</code> æˆ‘å°±æ‡‚äº†ã€‚</p>
<p>è¿™ç©æ„çš„æ„æ€æ˜¯ Cloudflare å‹æ ¹æ²¡ç¼“å­˜è¿™ä¸ªé¡µé¢ï¼Œæ¯æ¬¡è®¿é—®éƒ½è¦å›æºåˆ°æˆ‘çš„æœåŠ¡å™¨ã€‚è€Œæˆ‘çš„æœåŠ¡å™¨åœ¨å›½å¤–ï¼Œç½‘ç»œå»¶è¿ŸåŠ ä¸Š TLS æ¡æ‰‹ï¼Œ2 ç§’å¤šå…¶å®ä¸ç®—æ„å¤–ã€‚</p>
<h2 id="é—®é¢˜å‡ºåœ¨å“ª">é—®é¢˜å‡ºåœ¨å“ª</h2>
<p>Cloudflare æœ‰ä¸ª&quot;ç‰¹æ€§&quot;ï¼š<strong>é»˜è®¤ä¸ç¼“å­˜ HTML é¡µé¢</strong>ã€‚</p>
<p>å®ƒçš„é€»è¾‘æ˜¯ HTML é€šå¸¸æ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼Œä¸é€‚åˆç¼“å­˜ã€‚ä½†å¯¹äºé™æ€åšå®¢æ¥è¯´ï¼ŒHTML å°±æ˜¯é™æ€æ–‡ä»¶å•Šï¼Œä¸ºå•¥ä¸èƒ½ç¼“å­˜ï¼Ÿ</p>
<h2 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h2>
<p>éœ€è¦æ‰‹åŠ¨åŠ ä¸€æ¡ Cache Ruleï¼Œå‘Šè¯‰ Cloudflareï¼šè¿™ä¸ªåŸŸåä¸‹çš„ HTML ä¹Ÿç»™æˆ‘ç¼“å­˜ä¸Šã€‚</p>
<p>æ“ä½œæ­¥éª¤ï¼š</p>
<ol>
<li>ç™»å½• Cloudflare Dashboard</li>
<li>é€‰ä½ çš„åŸŸå</li>
<li>è¿› <strong>Caching</strong> â†’ <strong>Cache Rules</strong></li>
<li>åˆ›å»ºè§„åˆ™ï¼š</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">åŒ¹é…æ¡ä»¶: ä¸»æœºå = blog.kkkk24juastin.asia
</span></span><span class="line"><span class="cl">ç¼“å­˜è®¾ç½®: 
</span></span><span class="line"><span class="cl">  - ç¬¦åˆç¼“å­˜æ¡ä»¶: æ˜¯
</span></span><span class="line"><span class="cl">  - è¾¹ç¼˜ TTL: 1 ä¸ªæœˆ
</span></span><span class="line"><span class="cl">  - æµè§ˆå™¨ TTL: 1 å¤©
</span></span></code></pre></div><p>ä¿å­˜ï¼Œç­‰å‡ åˆ†é’Ÿç”Ÿæ•ˆã€‚</p>
<h2 id="æ•ˆæœéªŒè¯">æ•ˆæœéªŒè¯</h2>
<p>å†è·‘ä¸€éï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># ç¬¬ä¸€æ¬¡ï¼Œé¢„çƒ­ç¼“å­˜</span>
</span></span><span class="line"><span class="cl">curl -s -o /dev/null -w <span class="s2">&#34;TTFB: %{time_starttransfer}s\n&#34;</span> https://blog.kkkk24juastin.asia/
</span></span><span class="line"><span class="cl"><span class="c1"># TTFB: 1.1sï¼ˆå›æºäº†ï¼‰</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ç¬¬äºŒæ¬¡ï¼Œç¼“å­˜å‘½ä¸­</span>
</span></span><span class="line"><span class="cl">curl -s -o /dev/null -w <span class="s2">&#34;TTFB: %{time_starttransfer}s\n&#34;</span> https://blog.kkkk24juastin.asia/
</span></span><span class="line"><span class="cl"><span class="c1"># TTFB: 0.045s</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ç¡®è®¤ç¼“å­˜çŠ¶æ€</span>
</span></span><span class="line"><span class="cl">curl -sI https://blog.kkkk24juastin.asia/ <span class="p">|</span> grep cf-cache-status
</span></span><span class="line"><span class="cl"><span class="c1"># cf-cache-status: HIT</span>
</span></span></code></pre></div><p>ä» 2.28s é™åˆ° 45msï¼Œæå‡äº† 98%ã€‚</p>
<p>èˆ’æœäº†ã€‚</p>
<h2 id="è¿˜åšäº†å•¥">è¿˜åšäº†å•¥</h2>
<p>æ—¢ç„¶éƒ½æŠ˜è…¾äº†ï¼Œé¡ºæ‰‹åšäº†å‡ ä¸ªå°ä¼˜åŒ–ï¼š</p>
<h3 id="1-ç¡®è®¤-brotli-å‹ç¼©å¼€äº†">1. ç¡®è®¤ Brotli å‹ç¼©å¼€äº†</h3>
<p>åœ¨ Cloudflare çš„ Speed â†’ Optimization é‡Œï¼Œç¡®ä¿ Brotli æ˜¯å¼€ç€çš„ã€‚æ¯” Gzip å‹ç¼©ç‡æ›´é«˜ã€‚</p>
<h3 id="2-åŠ äº†èµ„æºé¢„åŠ è½½">2. åŠ äº†èµ„æºé¢„åŠ è½½</h3>
<p>åœ¨ <code>extend_head.html</code> é‡ŒåŠ äº† DNS é¢„è§£æï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;dns-prefetch&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;//fonts.googleapis.com&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;preconnect&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;https://fonts.googleapis.com&#34;</span> <span class="na">crossorigin</span><span class="p">&gt;</span>
</span></span></code></pre></div><h3 id="3-æ„å»ºæ—¶è‡ªåŠ¨æ¸…ç¼“å­˜">3. æ„å»ºæ—¶è‡ªåŠ¨æ¸…ç¼“å­˜</h3>
<p>åœ¨ GitHub Actions é‡ŒåŠ äº†ä¸€æ­¥ï¼Œæ¯æ¬¡éƒ¨ç½²å®Œè‡ªåŠ¨æ¸… Cloudflare ç¼“å­˜ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl">- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">æ¸…ç¼“å­˜</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">    curl -X POST &#34;https://api.cloudflare.com/client/v4/zones/$CF_ZONE_ID/purge_cache&#34; \
</span></span></span><span class="line"><span class="cl"><span class="sd">      -H &#34;Authorization: Bearer $CF_API_TOKEN&#34; \
</span></span></span><span class="line"><span class="cl"><span class="sd">      --data &#39;{&#34;purge_everything&#34;:true}&#39;</span><span class="w">
</span></span></span></code></pre></div><p>è¿™æ ·æ¯æ¬¡æ›´æ–°æ–‡ç« ï¼ŒCDN ä¼šç«‹åˆ»æ‹‰å–æœ€æ–°å†…å®¹ã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>å¯¹äºé™æ€åšå®¢æ¥è¯´ï¼Œä¼˜åŒ–çš„é‡ç‚¹ä¸åœ¨ä»£ç å±‚é¢ï¼ˆHugo å·²ç»å¤Ÿå¿«äº†ï¼‰ï¼Œè€Œæ˜¯<strong>è®© CDN çœŸæ­£å‘æŒ¥ä½œç”¨</strong>ã€‚</p>
<p>å¦‚æœä½ çš„åšå®¢ä¹ŸæŒ‚ç€ Cloudflare ä½†è¿˜æ˜¯æ…¢ï¼Œå…ˆæ£€æŸ¥ä¸€ä¸‹ <code>cf-cache-status</code> æ˜¯ä¸æ˜¯ <code>HIT</code>ã€‚ä¸æ˜¯çš„è¯ï¼Œå¤šåŠæ˜¯ç¼“å­˜è§„åˆ™æ²¡é…å¥½ã€‚</p>
<p>å°±è¿™æ ·ï¼Œæ”¶å·¥ã€‚</p>
]]></content:encoded>
    </item>
    <item>
      <title>Hugo åšå®¢åŠ è½½é€Ÿåº¦ä¼˜åŒ–å®è·µ</title>
      <link>https://blog.kkkk24juastin.asia/posts/hugo-blog-performance-optimization/</link>
      <pubDate>Wed, 04 Feb 2026 00:00:00 +0000</pubDate>
      <guid>https://blog.kkkk24juastin.asia/posts/hugo-blog-performance-optimization/</guid>
      <description>è®°å½•ä¼˜åŒ– Hugo &#43; PaperMod åšå®¢åŠ è½½é€Ÿåº¦çš„å®Œæ•´è¿‡ç¨‹ï¼ŒåŒ…æ‹¬æ„å»ºé…ç½®ã€å›¾ç‰‡æ‡’åŠ è½½ã€èµ„æºå‹ç¼©ç­‰å¤šä¸ªæ–¹é¢</description>
      <content:encoded><![CDATA[<h2 id="å‘ç°é—®é¢˜">å‘ç°é—®é¢˜</h2>
<p>åšå®¢æ­å»ºå®Œæˆåï¼Œè®¿é—®æ—¶æ€»è§‰å¾—æœ‰ç‚¹å¡ã€‚æ‰“å¼€ Chrome DevTools çœ‹äº†ä¸‹ Network é¢æ¿ï¼Œå‘ç°å‡ ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li>å›¾ç‰‡æ²¡æœ‰åšæ‡’åŠ è½½ï¼Œé¦–å±å°±åŠ è½½äº†æ‰€æœ‰å›¾ç‰‡</li>
<li>HTML/CSS/JS æ–‡ä»¶å¯ä»¥è¿›ä¸€æ­¥å‹ç¼©</li>
<li>æ²¡æœ‰åˆ©ç”¨å¥½æµè§ˆå™¨ç¼“å­˜</li>
<li>å¤–éƒ¨èµ„æºï¼ˆå¦‚å­—ä½“ï¼‰è¯·æ±‚æœ‰å»¶è¿Ÿ</li>
</ol>
<p>æ—¢ç„¶å‘ç°äº†é—®é¢˜ï¼Œé‚£å°±ä¸€ä¸ªä¸ªè§£å†³ã€‚</p>
<h2 id="hugo-æ„å»ºä¼˜åŒ–">Hugo æ„å»ºä¼˜åŒ–</h2>
<h3 id="æ·±åº¦å‹ç¼©é…ç½®">æ·±åº¦å‹ç¼©é…ç½®</h3>
<p>Hugo è‡ªå¸¦ minify åŠŸèƒ½ï¼Œä½†é»˜è®¤é…ç½®æ¯”è¾ƒä¿å®ˆã€‚åœ¨ <code>hugo.toml</code> ä¸­å¯ä»¥é…ç½®æ›´æ¿€è¿›çš„å‹ç¼©é€‰é¡¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-toml" data-lang="toml"><span class="line"><span class="cl"><span class="p">[</span><span class="nx">minify</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="nx">disableXML</span> <span class="p">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">  <span class="nx">minifyOutput</span> <span class="p">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">[</span><span class="nx">minify</span><span class="p">.</span><span class="nx">tdewolff</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">[</span><span class="nx">minify</span><span class="p">.</span><span class="nx">tdewolff</span><span class="p">.</span><span class="nx">css</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="nx">keepCSS2</span> <span class="p">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">      <span class="nx">precision</span> <span class="p">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="p">[</span><span class="nx">minify</span><span class="p">.</span><span class="nx">tdewolff</span><span class="p">.</span><span class="nx">html</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="nx">keepDocumentTags</span> <span class="p">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">      <span class="nx">keepEndTags</span> <span class="p">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">      <span class="nx">keepQuotes</span> <span class="p">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">      <span class="nx">keepWhitespace</span> <span class="p">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="p">[</span><span class="nx">minify</span><span class="p">.</span><span class="nx">tdewolff</span><span class="p">.</span><span class="nx">js</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="nx">keepVarNames</span> <span class="p">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">      <span class="nx">precision</span> <span class="p">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="p">[</span><span class="nx">minify</span><span class="p">.</span><span class="nx">tdewolff</span><span class="p">.</span><span class="nx">json</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="nx">keepNumbers</span> <span class="p">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">      <span class="nx">precision</span> <span class="p">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="p">[</span><span class="nx">minify</span><span class="p">.</span><span class="nx">tdewolff</span><span class="p">.</span><span class="nx">svg</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="nx">keepComments</span> <span class="p">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">      <span class="nx">precision</span> <span class="p">=</span> <span class="mi">0</span>
</span></span></code></pre></div><p>è¿™ä¸ªé…ç½®ä½¿ç”¨äº† <a href="https://github.com/tdewolff/minify">tdewolff/minify</a> åº“çš„å‚æ•°ï¼Œå¯ä»¥å¯¹å„ç±»èµ„æºåšæ·±åº¦å‹ç¼©ï¼š</p>
<ul>
<li><strong>CSS</strong>: ç§»é™¤ä¸å¿…è¦çš„ç©ºæ ¼ã€ç®€åŒ–æ•°å€¼ç²¾åº¦</li>
<li><strong>HTML</strong>: ç§»é™¤ç©ºç™½ã€å¯é€‰å¼•å·</li>
<li><strong>JS</strong>: å‹ç¼©å˜é‡å</li>
<li><strong>SVG</strong>: ç§»é™¤æ³¨é‡Šã€ç®€åŒ–æ•°å€¼</li>
</ul>
<h3 id="æ„å»ºç¼“å­˜">æ„å»ºç¼“å­˜</h3>
<p>é‡å¤æ„å»ºæ—¶ï¼Œå¾ˆå¤šèµ„æºæ˜¯ä¸å˜çš„ï¼Œå¯ä»¥åˆ©ç”¨ç¼“å­˜åŠ é€Ÿï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-toml" data-lang="toml"><span class="line"><span class="cl"><span class="p">[</span><span class="nx">build</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="nx">writeStats</span> <span class="p">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="nx">caches</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="p">[</span><span class="nx">caches</span><span class="p">.</span><span class="nx">assets</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="nx">dir</span> <span class="p">=</span> <span class="s2">&#34;:resourceDir/_gen&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">maxAge</span> <span class="p">=</span> <span class="s2">&#34;720h&#34;</span>  <span class="c"># 30 å¤©</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="p">[</span><span class="nx">caches</span><span class="p">.</span><span class="nx">getcsv</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="nx">dir</span> <span class="p">=</span> <span class="s2">&#34;:cacheDir/:project&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">maxAge</span> <span class="p">=</span> <span class="s2">&#34;4h&#34;</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="p">[</span><span class="nx">caches</span><span class="p">.</span><span class="nx">getjson</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="nx">dir</span> <span class="p">=</span> <span class="s2">&#34;:cacheDir/:project&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">maxAge</span> <span class="p">=</span> <span class="s2">&#34;4h&#34;</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="p">[</span><span class="nx">caches</span><span class="p">.</span><span class="nx">getresource</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="nx">dir</span> <span class="p">=</span> <span class="s2">&#34;:cacheDir/:project&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">maxAge</span> <span class="p">=</span> <span class="s2">&#34;4h&#34;</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="p">[</span><span class="nx">caches</span><span class="p">.</span><span class="nx">images</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="nx">dir</span> <span class="p">=</span> <span class="s2">&#34;:resourceDir/_gen&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">maxAge</span> <span class="p">=</span> <span class="s2">&#34;720h&#34;</span>
</span></span></code></pre></div><p><code>writeStats = true</code> ä¼šç”Ÿæˆä¸€ä¸ªåŒ…å«æ‰€æœ‰ä½¿ç”¨è¿‡çš„ç±»åçš„æ–‡ä»¶ï¼Œå¯ä»¥é…åˆ PurgeCSS åš tree-shakingï¼ˆè™½ç„¶ PaperMod ä¸»é¢˜æœ¬èº«å·²ç»å¾ˆç²¾ç®€äº†ï¼‰ã€‚</p>
<h3 id="å›¾ç‰‡å¤„ç†ä¼˜åŒ–">å›¾ç‰‡å¤„ç†ä¼˜åŒ–</h3>
<p>Hugo çš„å›¾ç‰‡å¤„ç†åŠŸèƒ½å¾ˆå¼ºå¤§ï¼Œåˆç†é…ç½®å¯ä»¥å‡å°å›¾ç‰‡ä½“ç§¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-toml" data-lang="toml"><span class="line"><span class="cl"><span class="p">[</span><span class="nx">imaging</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="nx">quality</span> <span class="p">=</span> <span class="mi">80</span>
</span></span><span class="line"><span class="cl">  <span class="nx">resampleFilter</span> <span class="p">=</span> <span class="s2">&#34;Lanczos&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">hint</span> <span class="p">=</span> <span class="s2">&#34;photo&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">anchor</span> <span class="p">=</span> <span class="s2">&#34;Smart&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">bgColor</span> <span class="p">=</span> <span class="s2">&#34;#ffffff&#34;</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="p">[</span><span class="nx">imaging</span><span class="p">.</span><span class="nx">exif</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="nx">disableDate</span> <span class="p">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">    <span class="nx">disableLatLong</span> <span class="p">=</span> <span class="kc">true</span>  <span class="c"># ä¿æŠ¤éšç§</span>
</span></span></code></pre></div><ul>
<li><code>quality = 80</code>ï¼šå›¾ç‰‡è´¨é‡è®¾ä¸º 80%ï¼Œè‚‰çœ¼å‡ ä¹çœ‹ä¸å‡ºå·®åˆ«ï¼Œä½†ä½“ç§¯èƒ½å‡å°ä¸å°‘</li>
<li><code>resampleFilter = &quot;Lanczos&quot;</code>ï¼šé«˜è´¨é‡é‡é‡‡æ ·ç®—æ³•ï¼Œé€‚åˆç¼©æ”¾ç…§ç‰‡</li>
<li><code>anchor = &quot;Smart&quot;</code>ï¼šæ™ºèƒ½è£å‰ªï¼Œè‡ªåŠ¨è¯†åˆ«å›¾ç‰‡ä¸»ä½“</li>
<li><code>disableLatLong = true</code>ï¼šç§»é™¤ EXIF ä¸­çš„ä½ç½®ä¿¡æ¯ï¼Œä¿æŠ¤éšç§</li>
</ul>
<h2 id="å‰ç«¯ä¼˜åŒ–">å‰ç«¯ä¼˜åŒ–</h2>
<h3 id="dns-é¢„è§£æå’Œé¢„è¿æ¥">DNS é¢„è§£æå’Œé¢„è¿æ¥</h3>
<p>æµè§ˆå™¨è§£æåŸŸåéœ€è¦æ—¶é—´ï¼Œå¯ä»¥ç”¨ <code>dns-prefetch</code> æå‰è§£æå¤–éƒ¨åŸŸåï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="c">&lt;!-- æ”¾åœ¨ layouts/partials/extend_head.html --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;dns-prefetch&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;//fonts.googleapis.com&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;dns-prefetch&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;//fonts.gstatic.com&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;dns-prefetch&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;//cdn.jsdelivr.net&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;preconnect&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;https://fonts.googleapis.com&#34;</span> <span class="na">crossorigin</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;preconnect&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;https://fonts.gstatic.com&#34;</span> <span class="na">crossorigin</span><span class="p">&gt;</span>
</span></span></code></pre></div><p><code>preconnect</code> æ¯” <code>dns-prefetch</code> æ›´è¿›ä¸€æ­¥ï¼Œä¼šæå‰å»ºç«‹å®Œæ•´çš„ TCP è¿æ¥ã€‚</p>
<h3 id="å›¾ç‰‡æ‡’åŠ è½½">å›¾ç‰‡æ‡’åŠ è½½</h3>
<p>ç°ä»£æµè§ˆå™¨éƒ½æ”¯æŒåŸç”Ÿçš„ <code>loading=&quot;lazy&quot;</code> å±æ€§ï¼Œä¸éœ€è¦é¢å¤–çš„ JS åº“ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;DOMContentLoaded&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">function</span> <span class="nx">addLoadedClass</span><span class="p">(</span><span class="nx">img</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">img</span><span class="p">.</span><span class="nx">complete</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">img</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;loaded&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">img</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">img</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;loaded&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">&#39;.post-content img&#39;</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">img</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">img</span><span class="p">.</span><span class="nx">hasAttribute</span><span class="p">(</span><span class="s1">&#39;loading&#39;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">img</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;loading&#39;</span><span class="p">,</span> <span class="s1">&#39;lazy&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="nx">img</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;decoding&#39;</span><span class="p">,</span> <span class="s1">&#39;async&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">addLoadedClass</span><span class="p">(</span><span class="nx">img</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></div><p>è¿™æ®µä»£ç åšäº†ä¸¤ä»¶äº‹ï¼š</p>
<ol>
<li>ç»™æ‰€æœ‰æ–‡ç« å›¾ç‰‡æ·»åŠ  <code>loading=&quot;lazy&quot;</code> å’Œ <code>decoding=&quot;async&quot;</code> å±æ€§</li>
<li>å›¾ç‰‡åŠ è½½å®Œæˆåæ·»åŠ  <code>loaded</code> ç±»ï¼Œé…åˆ CSS åšæ¸æ˜¾æ•ˆæœ</li>
</ol>
<h3 id="å›¾ç‰‡æ¸æ˜¾æ•ˆæœ">å›¾ç‰‡æ¸æ˜¾æ•ˆæœ</h3>
<p>é…åˆä¸Šé¢çš„ JSï¼Œåœ¨ CSS ä¸­å®ç°å¹³æ»‘çš„æ¸æ˜¾æ•ˆæœï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-css" data-lang="css"><span class="line"><span class="cl"><span class="c">/* assets/css/extended/custom.css */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nc">post-content</span> <span class="nt">img</span><span class="o">,</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nc">entry-cover</span> <span class="nt">img</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">background-color</span><span class="p">:</span> <span class="nf">var</span><span class="p">(</span><span class="o">--</span><span class="n">code</span><span class="o">-</span><span class="n">bg</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">transition</span><span class="p">:</span> <span class="k">opacity</span> <span class="mf">0.3</span><span class="kt">s</span> <span class="kc">ease-in-out</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nc">post-content</span> <span class="nt">img</span><span class="o">[</span><span class="nt">loading</span><span class="o">=</span><span class="s2">&#34;lazy&#34;</span><span class="o">],</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nc">entry-cover</span> <span class="nt">img</span><span class="o">[</span><span class="nt">loading</span><span class="o">=</span><span class="s2">&#34;lazy&#34;</span><span class="o">]</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">opacity</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nc">post-content</span> <span class="nt">img</span><span class="p">.</span><span class="nc">loaded</span><span class="o">,</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nc">entry-cover</span> <span class="nt">img</span><span class="p">.</span><span class="nc">loaded</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">opacity</span><span class="p">:</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>è¿™æ ·å›¾ç‰‡åœ¨åŠ è½½æ—¶ä¼šæ˜¾ç¤ºä¸€ä¸ªç°è‰²å ä½èƒŒæ™¯ï¼ŒåŠ è½½å®Œæˆåå¹³æ»‘æ˜¾ç¤ºã€‚</p>
<h3 id="å‡å°‘å¸ƒå±€åç§»">å‡å°‘å¸ƒå±€åç§»</h3>
<p>å›¾ç‰‡åŠ è½½æ—¶å¦‚æœæ²¡æœ‰é¢„ç•™ç©ºé—´ï¼Œä¼šå¯¼è‡´é¡µé¢å¸ƒå±€è·³åŠ¨ï¼ˆCLS æŒ‡æ ‡ï¼‰ï¼Œç”¨æˆ·ä½“éªŒå¾ˆå·®ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-css" data-lang="css"><span class="line"><span class="cl"><span class="p">.</span><span class="nc">post-content</span> <span class="nt">img</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">aspect-ratio</span><span class="p">:</span> <span class="nb">attr</span><span class="p">(</span><span class="n">width</span><span class="p">)</span> <span class="o">/</span> <span class="nb">attr</span><span class="p">(</span><span class="n">height</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">height</span><span class="p">:</span> <span class="kc">auto</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">max-width</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>å¦‚æœå›¾ç‰‡è®¾ç½®äº† width å’Œ height å±æ€§ï¼Œæµè§ˆå™¨å¯ä»¥æå‰è®¡ç®—å‡ºå›¾ç‰‡çš„å®½é«˜æ¯”ï¼Œé¢„ç•™å¥½ç©ºé—´ã€‚</p>
<h3 id="å°Šé‡ç”¨æˆ·åå¥½">å°Šé‡ç”¨æˆ·åå¥½</h3>
<p>æœ‰äº›ç”¨æˆ·å¯èƒ½å¯¹åŠ¨ç”»æ•æ„Ÿï¼Œå¯ä»¥æ£€æµ‹å¹¶ç¦ç”¨è¿‡æ¸¡æ•ˆæœï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-css" data-lang="css"><span class="line"><span class="cl"><span class="p">@</span><span class="k">media</span> <span class="o">(</span><span class="nt">prefers-reduced-motion</span><span class="o">:</span> <span class="nt">no-preference</span><span class="o">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">html</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">scroll-behavior</span><span class="p">:</span> <span class="kc">smooth</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">@</span><span class="k">media</span> <span class="o">(</span><span class="nt">prefers-reduced-motion</span><span class="o">:</span> <span class="nt">reduce</span><span class="o">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="o">*,</span>
</span></span><span class="line"><span class="cl">  <span class="o">*</span><span class="p">::</span><span class="nd">before</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">  <span class="o">*</span><span class="p">::</span><span class="nd">after</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">animation-duration</span><span class="p">:</span> <span class="mf">0.01</span><span class="kt">ms</span> <span class="cp">!important</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">transition-duration</span><span class="p">:</span> <span class="mf">0.01</span><span class="kt">ms</span> <span class="cp">!important</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">scroll-behavior</span><span class="p">:</span> <span class="kc">auto</span> <span class="cp">!important</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="ä¼˜åŒ–æ•ˆæœ">ä¼˜åŒ–æ•ˆæœ</h2>
<p>åšå®Œè¿™äº›ä¼˜åŒ–åï¼Œå†çœ‹ Lighthouse è·‘åˆ†ï¼š</p>
<table>
  <thead>
      <tr>
          <th>æŒ‡æ ‡</th>
          <th>ä¼˜åŒ–å‰</th>
          <th>ä¼˜åŒ–å</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>é¦–æ¬¡å†…å®¹ç»˜åˆ¶ (FCP)</td>
          <td>~1.5s</td>
          <td>~0.8s</td>
      </tr>
      <tr>
          <td>æœ€å¤§å†…å®¹ç»˜åˆ¶ (LCP)</td>
          <td>~2.5s</td>
          <td>~1.5s</td>
      </tr>
      <tr>
          <td>ç´¯ç§¯å¸ƒå±€åç§» (CLS)</td>
          <td>0.15</td>
          <td>&lt; 0.05</td>
      </tr>
  </tbody>
</table>
<p>å½“ç„¶ï¼Œå®é™…æ•ˆæœè¿˜å–å†³äºæœåŠ¡å™¨æ€§èƒ½å’Œç”¨æˆ·ç½‘ç»œã€‚</p>
<h2 id="æ›´å¤šä¼˜åŒ–æ€è·¯">æ›´å¤šä¼˜åŒ–æ€è·¯</h2>
<p>è¿™æ¬¡åªåšäº† Hugo æœ¬èº«çš„ä¼˜åŒ–ï¼Œè¿˜æœ‰ä¸€äº›å¯ä»¥ç»§ç»­ä¼˜åŒ–çš„æ–¹å‘ï¼š</p>
<ol>
<li><strong>CDN åŠ é€Ÿ</strong>ï¼šæŠŠé™æ€èµ„æºæ”¾åˆ° CDN ä¸Šï¼Œå…¨çƒè®¿é—®éƒ½å¾ˆå¿«</li>
<li><strong>Gzip/Brotli å‹ç¼©</strong>ï¼šæœåŠ¡å™¨å¼€å¯å‹ç¼©ï¼Œè¿›ä¸€æ­¥å‡å°ä¼ è¾“ä½“ç§¯</li>
<li><strong>HTTP/2</strong>ï¼šå¯ç”¨ HTTP/2 å¤šè·¯å¤ç”¨ï¼Œå¹¶è¡ŒåŠ è½½èµ„æº</li>
<li><strong>å­—ä½“ä¼˜åŒ–</strong>ï¼šä½¿ç”¨ <code>font-display: swap</code> é¿å…å­—ä½“é˜»å¡æ¸²æŸ“</li>
<li><strong>å›¾ç‰‡æ ¼å¼</strong>ï¼šä½¿ç”¨ WebP/AVIF ç­‰ç°ä»£æ ¼å¼</li>
</ol>
<p>åç»­æœ‰ç©ºå†ç»§ç»­æŠ˜è…¾ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2>
<ul>
<li><a href="https://gohugo.io/getting-started/configuration/#configure-minify">Hugo å®˜æ–¹æ–‡æ¡£ - Configure Minify</a></li>
<li><a href="https://gohugo.io/content-management/image-processing/">Hugo å®˜æ–¹æ–‡æ¡£ - Image Processing</a></li>
<li><a href="https://web.dev/browser-level-image-lazy-loading/">Web.dev - Browser-level image lazy loading</a></li>
<li><a href="https://web.dev/optimize-cls/">Web.dev - Optimize Cumulative Layout Shift</a></li>
</ul>
]]></content:encoded>
    </item>
    <item>
      <title>ç»™åšå®¢åŠ ä¸ª Live2D çœ‹æ¿å¨˜</title>
      <link>https://blog.kkkk24juastin.asia/posts/add-live2d-to-hexo-blog/</link>
      <pubDate>Tue, 03 Feb 2026 01:29:00 +0800</pubDate>
      <guid>https://blog.kkkk24juastin.asia/posts/add-live2d-to-hexo-blog/</guid>
      <description>ç»™ Hexo åšå®¢åŠ ä¸ªä¼šåŠ¨çš„äºŒæ¬¡å…ƒå°äººï¼Œæ²¡å•¥å®é™…ç”¨å¤„ï¼Œå°±æ˜¯çœ‹ç€èˆ’æœ</description>
      <content:encoded><![CDATA[<p>ä¹‹å‰é€›åˆ«äººåšå®¢çš„æ—¶å€™ï¼Œç»å¸¸çœ‹åˆ°å·¦ä¸‹è§’æœ‰ä¸ªä¼šåŠ¨çš„å°äººï¼Œçœ¼ç›è¿˜ä¼šè·Ÿç€é¼ æ ‡è·‘ï¼Œæ„Ÿè§‰æŒºæœ‰æ„æ€çš„ã€‚ç ”ç©¶äº†ä¸€ä¸‹å‘ç°è¿™ç©æ„å« Live2Dï¼Œäºæ˜¯å†³å®šç»™è‡ªå·±çš„ Hexo åšå®¢ä¹Ÿæ•´ä¸€ä¸ªã€‚</p>
<p>æŠ˜è…¾äº†ä¸€æ™šä¸Šï¼Œè¸©äº†ä¸å°‘å‘ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹å®ç°è¿‡ç¨‹ã€‚</p>
<h2 id="æ•ˆæœ">æ•ˆæœ</h2>
<p>åŠ å®Œä¹‹åï¼Œåšå®¢å·¦ä¸‹è§’ä¼šå¤šä¸€ä¸ªäºŒæ¬¡å…ƒå°äººï¼Œèƒ½ï¼š</p>
<ul>
<li>çœ¼ç›è·Ÿç€é¼ æ ‡åŠ¨ï¼ˆæœ‰ç‚¹é­”æ€§ï¼‰</li>
<li>éšæœºæ˜¾ç¤ºä¸€è¨€</li>
<li>æ¢è£…ã€æ¢æ¨¡å‹</li>
<li>æˆªå›¾ä¿å­˜</li>
<li>è¿˜èƒ½ç©ä¸ªæ‰“ç –å—å°æ¸¸æˆ</li>
</ul>
<p>è¯´å®è¯æ²¡å•¥å®é™…ç”¨å¤„ï¼Œä½†çœ‹ç€å°±æ˜¯èˆ’æœ ğŸ˜‚</p>
<h2 id="æœ€ç®€å•çš„æ–¹å¼">æœ€ç®€å•çš„æ–¹å¼</h2>
<p>å¦‚æœåªæ˜¯æƒ³å¿«é€Ÿä½“éªŒï¼Œä¸€è¡Œä»£ç å°±å¤Ÿäº†ã€‚</p>
<p>åœ¨ä¸»é¢˜çš„ <code>layout/layout.ejs</code> é‡ŒåŠ ä¸Šï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;https://fastly.jsdelivr.net/npm/live2d-widgets@1.0.0/dist/autoload.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>æ”¾åœ¨ <code>&lt;/body&gt;</code> ä¹‹å‰å°±è¡Œã€‚åˆ·æ–°é¡µé¢ï¼Œçœ‹æ¿å¨˜åº”è¯¥å°±å‡ºæ¥äº†ã€‚</p>
<p>ä¸è¿‡è¿™ç§æ–¹å¼æ²¡æ³•è‡ªå®šä¹‰ï¼Œæƒ³è¦æ›´å¤šæ§åˆ¶å°±å¾—ç”¨ä¸‹é¢çš„æ–¹æ³•ã€‚</p>
<h2 id="å®Œæ•´é…ç½®ç‰ˆ">å®Œæ•´é…ç½®ç‰ˆ</h2>
<h3 id="ç¬¬ä¸€æ­¥åˆ›å»ºç»„ä»¶">ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºç»„ä»¶</h3>
<p>åœ¨ä¸»é¢˜ç›®å½•çš„ <code>layout/_partial/</code> ä¸‹é¢æ–°å»ºä¸€ä¸ª <code>live2d.ejs</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">&lt;%</span><span class="c1"># çœ‹æ¿å¨˜ç»„ä»¶ %&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;%</span> <span class="k">if</span> <span class="p">(</span><span class="n">theme</span><span class="o">.</span><span class="n">live2d</span> <span class="o">&amp;&amp;</span> <span class="n">theme</span><span class="o">.</span><span class="n">live2d</span><span class="o">.</span><span class="n">enable</span><span class="p">)</span> <span class="p">{</span> <span class="o">%&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;%</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span> <span class="err">è¯»å–é…ç½®ï¼Œç»™ä¸ªé»˜è®¤å€¼å…œåº•</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">cdnPath</span> <span class="o">=</span> <span class="p">(</span><span class="n">theme</span><span class="o">.</span><span class="n">live2d</span><span class="o">.</span><span class="n">cdn</span> <span class="o">&amp;&amp;</span> <span class="n">theme</span><span class="o">.</span><span class="n">live2d</span><span class="o">.</span><span class="n">cdn</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">      <span class="err">?</span> <span class="n">theme</span><span class="o">.</span><span class="n">live2d</span><span class="o">.</span><span class="n">cdn</span><span class="o">.</span><span class="n">url</span> 
</span></span><span class="line"><span class="cl">      <span class="p">:</span> <span class="s1">&#39;https://fastly.jsdelivr.net/npm/live2d-widgets@1.0.0/dist/&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">modelId</span> <span class="o">=</span> <span class="p">(</span><span class="n">theme</span><span class="o">.</span><span class="n">live2d</span><span class="o">.</span><span class="n">model</span> <span class="o">&amp;&amp;</span> <span class="n">theme</span><span class="o">.</span><span class="n">live2d</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">id</span> <span class="o">!==</span> <span class="n">undefined</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">      <span class="err">?</span> <span class="n">theme</span><span class="o">.</span><span class="n">live2d</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">id</span> 
</span></span><span class="line"><span class="cl">      <span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">modelCdnPath</span> <span class="o">=</span> <span class="p">(</span><span class="n">theme</span><span class="o">.</span><span class="n">live2d</span><span class="o">.</span><span class="n">model</span> <span class="o">&amp;&amp;</span> <span class="n">theme</span><span class="o">.</span><span class="n">live2d</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">cdnPath</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">      <span class="err">?</span> <span class="n">theme</span><span class="o">.</span><span class="n">live2d</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">cdnPath</span> 
</span></span><span class="line"><span class="cl">      <span class="p">:</span> <span class="s1">&#39;https://fastly.jsdelivr.net/gh/fghrsh/live2d_api/&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">toolItems</span> <span class="o">=</span> <span class="p">(</span><span class="n">theme</span><span class="o">.</span><span class="n">live2d</span><span class="o">.</span><span class="n">tools</span> <span class="o">&amp;&amp;</span> <span class="n">theme</span><span class="o">.</span><span class="n">live2d</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">items</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">      <span class="err">?</span> <span class="n">theme</span><span class="o">.</span><span class="n">live2d</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">items</span> 
</span></span><span class="line"><span class="cl">      <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;hitokoto&#39;</span><span class="p">,</span> <span class="s1">&#39;asteroids&#39;</span><span class="p">,</span> <span class="s1">&#39;switch-model&#39;</span><span class="p">,</span> <span class="s1">&#39;switch-texture&#39;</span><span class="p">,</span> <span class="s1">&#39;photo&#39;</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;quit&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">drag</span> <span class="o">=</span> <span class="n">theme</span><span class="o">.</span><span class="n">live2d</span><span class="o">.</span><span class="n">drag</span> <span class="o">!==</span> <span class="n">undefined</span> <span class="err">?</span> <span class="n">theme</span><span class="o">.</span><span class="n">live2d</span><span class="o">.</span><span class="n">drag</span> <span class="p">:</span> <span class="bp">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">logLevel</span> <span class="o">=</span> <span class="n">theme</span><span class="o">.</span><span class="n">live2d</span><span class="o">.</span><span class="n">logLevel</span> <span class="o">||</span> <span class="s1">&#39;warn&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="o">%&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">live2d_path</span> <span class="o">=</span> <span class="s1">&#39;&lt;%= cdnPath %&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="o">//</span> <span class="err">åŠ¨æ€åŠ è½½èµ„æº</span>
</span></span><span class="line"><span class="cl">    <span class="n">function</span> <span class="n">loadExternalResource</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">type</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="n">new</span> <span class="n">Promise</span><span class="p">((</span><span class="n">resolve</span><span class="p">,</span> <span class="n">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">let</span> <span class="n">tag</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">===</span> <span class="s1">&#39;css&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">tag</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">createElement</span><span class="p">(</span><span class="s1">&#39;link&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="n">tag</span><span class="o">.</span><span class="n">rel</span> <span class="o">=</span> <span class="s1">&#39;stylesheet&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="n">tag</span><span class="o">.</span><span class="n">href</span> <span class="o">=</span> <span class="n">url</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">===</span> <span class="s1">&#39;js&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">tag</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">createElement</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="n">tag</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">&#39;module&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="n">tag</span><span class="o">.</span><span class="n">src</span> <span class="o">=</span> <span class="n">url</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">tag</span><span class="o">.</span><span class="n">onload</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="n">resolve</span><span class="p">(</span><span class="n">url</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="n">tag</span><span class="o">.</span><span class="n">onerror</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="n">reject</span><span class="p">(</span><span class="n">url</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="n">document</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">tag</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="n">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="o">//</span> <span class="err">æ‰‹æœºä¸Šå°±åˆ«åŠ è½½äº†ï¼Œå¤ªå åœ°æ–¹</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="n">screen</span><span class="o">.</span><span class="n">width</span> <span class="o">&lt;</span> <span class="mi">768</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      
</span></span><span class="line"><span class="cl">      <span class="o">//</span> <span class="err">å¤„ç†å›¾ç‰‡è·¨åŸŸï¼ˆè¿™ä¸ªå‘è¸©äº†å¥½ä¹…ï¼‰</span>
</span></span><span class="line"><span class="cl">      <span class="k">const</span> <span class="n">OriginalImage</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">Image</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">window</span><span class="o">.</span><span class="n">Image</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="o">...</span><span class="n">args</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">const</span> <span class="n">img</span> <span class="o">=</span> <span class="n">new</span> <span class="n">OriginalImage</span><span class="p">(</span><span class="o">...</span><span class="n">args</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">img</span><span class="o">.</span><span class="n">crossOrigin</span> <span class="o">=</span> <span class="s2">&#34;anonymous&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">img</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">};</span>
</span></span><span class="line"><span class="cl">      <span class="n">window</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">prototype</span> <span class="o">=</span> <span class="n">OriginalImage</span><span class="o">.</span><span class="n">prototype</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      
</span></span><span class="line"><span class="cl">      <span class="o">//</span> <span class="err">åŠ è½½èµ„æº</span>
</span></span><span class="line"><span class="cl">      <span class="n">await</span> <span class="n">Promise</span><span class="o">.</span><span class="n">all</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">        <span class="n">loadExternalResource</span><span class="p">(</span><span class="n">live2d_path</span> <span class="o">+</span> <span class="s1">&#39;waifu.css&#39;</span><span class="p">,</span> <span class="s1">&#39;css&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">loadExternalResource</span><span class="p">(</span><span class="n">live2d_path</span> <span class="o">+</span> <span class="s1">&#39;waifu-tips.js&#39;</span><span class="p">,</span> <span class="s1">&#39;js&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">]);</span>
</span></span><span class="line"><span class="cl">      
</span></span><span class="line"><span class="cl">      <span class="o">//</span> <span class="err">åˆå§‹åŒ–</span>
</span></span><span class="line"><span class="cl">      <span class="n">initWidget</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="n">waifuPath</span><span class="p">:</span> <span class="n">live2d_path</span> <span class="o">+</span> <span class="s1">&#39;waifu-tips.json&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">cdnPath</span><span class="p">:</span> <span class="s1">&#39;&lt;%= modelCdnPath %&gt;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">cubism2Path</span><span class="p">:</span> <span class="n">live2d_path</span> <span class="o">+</span> <span class="s1">&#39;live2d.min.js&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">cubism5Path</span><span class="p">:</span> <span class="s1">&#39;https://cubism.live2d.com/sdk-web/cubismcore/live2dcubismcore.min.js&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">modelId</span><span class="p">:</span> <span class="o">&lt;%=</span> <span class="n">modelId</span> <span class="o">%&gt;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">tools</span><span class="p">:</span> <span class="o">&lt;%-</span> <span class="n">JSON</span><span class="o">.</span><span class="n">stringify</span><span class="p">(</span><span class="n">toolItems</span><span class="p">)</span> <span class="o">%&gt;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">drag</span><span class="p">:</span> <span class="o">&lt;%=</span> <span class="n">drag</span> <span class="o">%&gt;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">logLevel</span><span class="p">:</span> <span class="s1">&#39;&lt;%= logLevel %&gt;&#39;</span>
</span></span><span class="line"><span class="cl">      <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">})();</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;%</span> <span class="p">}</span> <span class="o">%&gt;</span>
</span></span></code></pre></div><h3 id="ç¬¬äºŒæ­¥å¼•å…¥ç»„ä»¶">ç¬¬äºŒæ­¥ï¼šå¼•å…¥ç»„ä»¶</h3>
<p>åœ¨ <code>layout/layout.ejs</code> é‡Œå¼•å…¥ï¼ˆæ”¾åœ¨ <code>&lt;/body&gt;</code> å‰é¢ï¼‰ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;%- partial(&#39;_partial/live2d&#39;) %&gt;
</span></span></code></pre></div><h3 id="ç¬¬ä¸‰æ­¥é…ç½®ä¸»é¢˜">ç¬¬ä¸‰æ­¥ï¼šé…ç½®ä¸»é¢˜</h3>
<p>åœ¨ä¸»é¢˜çš„ <code>_config.yml</code> é‡Œæ·»åŠ ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># Live2D çœ‹æ¿å¨˜</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nt">live2d</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">enable</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">model</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">                    </span><span class="c"># é»˜è®¤æ¨¡å‹</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">cdnPath</span><span class="p">:</span><span class="w"> </span><span class="l">https://fastly.jsdelivr.net/gh/fghrsh/live2d_api/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">tools</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">items</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">hitokoto            </span><span class="w"> </span><span class="c"># ä¸€è¨€</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">asteroids           </span><span class="w"> </span><span class="c"># å°æ¸¸æˆ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">switch-model        </span><span class="w"> </span><span class="c"># åˆ‡æ¢æ¨¡å‹</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">switch-texture      </span><span class="w"> </span><span class="c"># åˆ‡æ¢çš®è‚¤</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">photo               </span><span class="w"> </span><span class="c"># æ‹ç…§</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">info                </span><span class="w"> </span><span class="c"># å…³äº</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">quit                </span><span class="w"> </span><span class="c"># å…³é—­</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">drag</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">logLevel</span><span class="p">:</span><span class="w"> </span><span class="l">warn</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">cdn</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">https://fastly.jsdelivr.net/npm/live2d-widgets@1.0.0/dist/</span><span class="w">
</span></span></span></code></pre></div><h2 id="è¸©è¿‡çš„å‘">è¸©è¿‡çš„å‘</h2>
<h3 id="1-çœ‹æ¿å¨˜å˜å½¢">1. çœ‹æ¿å¨˜å˜å½¢</h3>
<p>ä¸€å¼€å§‹åœ¨ CSS é‡Œç»™å®¹å™¨è®¾äº†å®½é«˜ï¼Œç»“æœæ¨¡å‹æ¯”ä¾‹å…¨ä¹±äº†ã€‚åæ¥å‘ç°è¦è®©å®ƒè‡ªå·±åŠ è½½ <code>waifu.css</code>ï¼Œä¸è¦æ‰‹åŠ¨è®¾ç½®å°ºå¯¸ã€‚</p>
<h3 id="2-å›¾ç‰‡è·¨åŸŸ">2. å›¾ç‰‡è·¨åŸŸ</h3>
<p>æ§åˆ¶å°ä¸€å †è·¨åŸŸé”™è¯¯ï¼Œæˆªå›¾åŠŸèƒ½ä¹Ÿç”¨ä¸äº†ã€‚è§£å†³æ–¹æ³•æ˜¯åœ¨åŠ è½½å‰ç»™ Image è®¾ç½® <code>crossOrigin</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">OriginalImage</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">Image</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nb">window</span><span class="p">.</span><span class="nx">Image</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">img</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OriginalImage</span><span class="p">(...</span><span class="nx">args</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">img</span><span class="p">.</span><span class="nx">crossOrigin</span> <span class="o">=</span> <span class="s2">&#34;anonymous&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">img</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><h3 id="3-æ‰‹æœºä¸Šå¤ªå åœ°æ–¹">3. æ‰‹æœºä¸Šå¤ªå åœ°æ–¹</h3>
<p>åŠ ä¸ªåˆ¤æ–­ï¼Œå±å¹•å°å°±ä¸åŠ è½½ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">width</span> <span class="o">&lt;</span> <span class="mi">768</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
</span></span></code></pre></div><h3 id="4-pjax-å¯¼è‡´é‡å¤åŠ è½½">4. PJAX å¯¼è‡´é‡å¤åŠ è½½</h3>
<p>æŠŠçœ‹æ¿å¨˜çš„ä»£ç æ”¾åˆ° PJAX åˆ·æ–°åŒºåŸŸå¤–é¢å°±å¥½äº†ã€‚</p>
<h2 id="æƒ³ç”¨è‡ªå·±çš„æ¨¡å‹">æƒ³ç”¨è‡ªå·±çš„æ¨¡å‹ï¼Ÿ</h2>
<p>é»˜è®¤ç”¨çš„æ˜¯ <a href="https://github.com/fghrsh/live2d_api">fghrsh çš„æ¨¡å‹ API</a>ï¼Œé‡Œé¢æ¨¡å‹æŒºå¤šçš„ã€‚</p>
<p>å¦‚æœæƒ³ç”¨è‡ªå·±çš„æ¨¡å‹ï¼Œå¯ä»¥ fork é‚£ä¸ªä»“åº“ï¼ŒæŠŠæ¨¡å‹æ”¾è¿›å»ï¼Œç„¶åæ”¹ä¸€ä¸‹ <code>cdnPath</code> æŒ‡å‘ä½ è‡ªå·±çš„åœ°å€ã€‚</p>
<h2 id="ç›¸å…³é“¾æ¥">ç›¸å…³é“¾æ¥</h2>
<ul>
<li><a href="https://github.com/stevenjoezhang/live2d-widget">live2d-widget é¡¹ç›®åœ°å€</a></li>
<li><a href="https://github.com/fghrsh/live2d_api">æ¨¡å‹èµ„æº live2d_api</a></li>
<li><a href="https://github.com/zenghongtu/live2d-model-assets">æ›´å¤šæ¨¡å‹èµ„æº</a></li>
</ul>
<hr>
<p>å°±è¿™äº›ã€‚è™½ç„¶åªæ˜¯ä¸ªå°ç©æ„ï¼Œä½†æŠ˜è…¾çš„è¿‡ç¨‹è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ã€‚</p>
<p>æœ‰é—®é¢˜å¯ä»¥ç•™è¨€ ğŸ‘‹</p>
]]></content:encoded>
    </item>
  </channel>
</rss>
