---
title: "èŠèŠè¿™ä¸ªåšå®¢æ˜¯æ€ä¹ˆè·‘èµ·æ¥çš„"
date: 2026-02-04
lastmod: 2026-02-06
draft: false
author: ["kkkk24"]
tags: ["Hugo", "GitHub Actions", "CI/CD", "åšå®¢"]
categories: ["æŠ˜è…¾è®°å½•"]
description: "è®°å½•ä¸€ä¸‹åšå®¢ä»å†™æ–‡ç« åˆ°ä¸Šçº¿çš„å…¨è¿‡ç¨‹ï¼Œæ¶‰åŠ Hugoã€GitHub Actionsã€æœåŠ¡å™¨éƒ¨ç½²å’Œ CDN åŠ é€Ÿ"
weight: 1
slug: "hugo-blog-architecture"
comments: true
showToc: true
TocOpen: true
hidemeta: false
disableShare: false
showbreadcrumbs: true
cover:
    image: ""
    caption: ""
    alt: ""
    relative: false
---

æœ€è¿‘æŠŠåšå®¢ä» Hexo æ¢æˆäº† Hugoï¼Œé¡ºä¾¿é‡æ–°è®¾è®¡äº†ä¸€ä¸‹æ„å»ºå’Œéƒ¨ç½²æµç¨‹ã€‚è¶çƒ­ä¹è®°å½•ä¸€ä¸‹ï¼Œä¹Ÿæ–¹ä¾¿ä»¥åè‡ªå·±æŸ¥ã€‚

## å…ˆè¯´ç»“è®ºï¼šæ•´ä½“æµç¨‹

ç®€å•æ¥è¯´å°±æ˜¯è¿™ä¹ˆä¸ªäº‹å„¿ï¼š

```
æˆ‘å†™ Markdown â†’ æ¨åˆ° GitHub â†’ Actions è‡ªåŠ¨ç¼–è¯‘ â†’ æœåŠ¡å™¨æ‹‰å– â†’ Cloudflare åŠ é€Ÿ
```

ç”»ä¸ªå›¾æ›´æ¸…æ¥šï¼š

```
æœ¬åœ°å†™æ–‡ç«  (Markdown)
        â†“ git push
GitHub main åˆ†æ”¯
        â†“ è§¦å‘ Actions
GitHub Actions ç¼–è¯‘
        â†“ ç”Ÿæˆé™æ€æ–‡ä»¶
gh-pages åˆ†æ”¯
        â†“ æœåŠ¡å™¨ git pull
Nginx æ‰˜ç®¡é™æ€æ–‡ä»¶
        â†“ 
Cloudflare CDN ç¼“å­˜åŠ é€Ÿ
        â†“
ç”¨æˆ·è®¿é—®
```

ä¸ºå•¥è¦æè¿™ä¹ˆå¤æ‚ï¼Ÿä¸»è¦æ˜¯ä¸æƒ³æ¯æ¬¡æ”¹ä¸ªé”™åˆ«å­—éƒ½è¦ç™»æœåŠ¡å™¨æ‰‹åŠ¨æ“ä½œã€‚

## ä¸ºå•¥é€‰ Hugo

ä¹‹å‰ç”¨çš„ Hexoï¼Œæ²¡å•¥å¤§æ¯›ç—…ï¼Œä½†æœ‰å‡ ä¸ªç—’ç‚¹ï¼š

1. **npm ä¾èµ–å¤ªå¤šäº†**ã€‚æ¯æ¬¡ CI å…‰è£…ä¾èµ–å°±å¾—å¥½ä¸€ä¼šå„¿ï¼Œå¶å°”è¿˜ä¼šå‡ºç‚¹ç‰ˆæœ¬å†²çªçš„å¹ºè›¾å­
2. **æœ¬åœ°é¢„è§ˆæ…¢**ã€‚æ–‡ç« å¤šäº†ä¹‹åï¼Œçƒ­æ›´æ–°æ˜æ˜¾å˜å¡
3. **æƒ³å°å°é²œ**ã€‚Hugo ç”¨ Go å†™çš„ï¼Œæ®è¯´å¿«å¾—ç¦»è°±

å®é™…ç”¨ä¸‹æ¥ï¼Œç¡®å®å¿«ã€‚æœ¬åœ°é¢„è§ˆåŸºæœ¬ç§’å¼€ï¼ŒGitHub Actions é‚£è¾¹æ„å»ºä¹Ÿå°±å‡ ç§’é’Ÿçš„äº‹ã€‚

## GitHub Actionsï¼šè‡ªåŠ¨åŒ–æ„å»º

è¿™æ˜¯æ•´å¥—æµç¨‹çš„æ ¸å¿ƒã€‚é…ç½®æ–‡ä»¶åœ¨ `.github/workflows/hugo.yml`ï¼Œåšçš„äº‹æƒ…ä¹Ÿç®€å•ï¼š

```yaml
name: Build Hugo Site

on:
  push:
    branches: [main]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: è£… Hugo
        run: |
          wget -O hugo.deb https://github.com/gohugoio/hugo/releases/...
          sudo dpkg -i hugo.deb

      - name: æ‹‰ä»£ç 
        uses: actions/checkout@v4
        with:
          submodules: recursive  # ä¸»é¢˜æ˜¯ submodule

      - name: ç¼–è¯‘
        run: hugo --gc --minify

      - name: æ¨åˆ° gh-pages
        uses: peaceiris/actions-gh-pages@v4
        with:
          publish_dir: ./public
          publish_branch: gh-pages

      - name: é¡ºæ‰‹æ¸…ä¸€ä¸‹ CDN ç¼“å­˜
        run: curl -X POST "https://api.cloudflare.com/..." ...
```

æ¯æ¬¡ push åˆ° main åˆ†æ”¯ï¼ŒActions å°±è‡ªåŠ¨è·‘è¿™ä¸€å¥—ã€‚æˆåŠŸä¹‹åï¼Œç¼–è¯‘å¥½çš„é™æ€æ–‡ä»¶å°±èººåœ¨ gh-pages åˆ†æ”¯é‡Œäº†ã€‚

## åŒåˆ†æ”¯ç­–ç•¥

è¿™ä¸ªè®¾è®¡æˆ‘æŒºæ»¡æ„çš„ï¼š

- **main åˆ†æ”¯**ï¼šæºä»£ç ï¼ŒMarkdown æ–‡ä»¶ + ä¸»é¢˜é…ç½®
- **gh-pages åˆ†æ”¯**ï¼šç¼–è¯‘äº§ç‰©ï¼Œçº¯é™æ€æ–‡ä»¶

å¥½å¤„æ˜¯æœåŠ¡å™¨ä¸Šä¸ç”¨è£… Hugoï¼Œç›´æ¥æ‹‰ gh-pages å°±èƒ½ç”¨ã€‚ä¸‡ä¸€å“ªå¤©æƒ³æ¢ä¸ªéƒ¨ç½²æ–¹å¼ï¼Œä¹Ÿæ–¹ä¾¿ã€‚

## æœåŠ¡å™¨è¿™è¾¹

æœåŠ¡å™¨å°±åšä¸¤ä»¶äº‹ï¼š

1. å®šæ—¶ï¼ˆæˆ–æ‰‹åŠ¨ï¼‰ä» gh-pages æ‹‰æœ€æ–°çš„é™æ€æ–‡ä»¶
2. Nginx ä¼ºå€™ç€

Nginx é…ç½®æ²¡å•¥ç‰¹åˆ«çš„ï¼Œä¸»è¦æ˜¯åŠ äº†ç‚¹ç¼“å­˜å’Œå‹ç¼©ï¼š

```nginx
server {
    listen 80;
    server_name blog.kkkk24juastin.asia;
    root /var/www/blog;
    
    # å‹ç¼©
    gzip on;
    gzip_types text/css application/javascript text/html;
    
    # é™æ€èµ„æºç¼“å­˜ä¹…ä¸€ç‚¹
    location ~* \.(css|js|png|jpg|woff2)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

æ›´æ–°è„šæœ¬ä¹Ÿå°±å‡ è¡Œï¼š

```bash
#!/bin/bash
cd /var/www/blog
git fetch origin gh-pages
git reset --hard origin/gh-pages
```

æ‰” crontab é‡Œå®šæ—¶è·‘ï¼Œæˆ–è€…é…ä¸ª webhook è§¦å‘éƒ½è¡Œã€‚

## Cloudflare åŠ é€Ÿ

æœ€åæŒ‚äº†å±‚ Cloudflareï¼Œä¸»è¦å›¾å‡ ä¸ªå¥½å¤„ï¼š

1. **å…¨çƒ CDN**ã€‚è®¿å®¢èƒ½ä»å°±è¿‘èŠ‚ç‚¹æ‹¿ç¼“å­˜ï¼Œä¸ç”¨æ¯æ¬¡éƒ½å›æº
2. **å…è´¹ SSL**ã€‚æ‡’å¾—è‡ªå·±æŠ˜è…¾è¯ä¹¦
3. **DDoS é˜²æŠ¤**ã€‚è™½ç„¶æˆ‘è¿™å°ç ´ç«™åº”è¯¥æ²¡äººä¼šæ‰“

ä¸è¿‡æœ‰ä¸ªå‘ï¼šCloudflare é»˜è®¤ä¸ç¼“å­˜ HTML é¡µé¢ã€‚å¯¹äºé™æ€åšå®¢æ¥è¯´è¿™å¤ªäºäº†ï¼Œå¾—æ‰‹åŠ¨åŠ ä¸ª Cache Ruleï¼Œè®©å®ƒæŠŠ HTML ä¹Ÿç¼“å­˜ä¸Šã€‚

é…ç½®å¥½ä¹‹åï¼Œè®¿é—®é€Ÿåº¦ä»ä¹‹å‰çš„ 2 ç§’å¤šé™åˆ°äº†å‡ åæ¯«ç§’ï¼Œæ•ˆæœç«‹ç«¿è§å½±ã€‚

## å®é™…æ•ˆæœ

ä¼˜åŒ–å‰åçš„å¯¹æ¯”ï¼š

| æŒ‡æ ‡ | ä¹‹å‰ | ç°åœ¨ |
|------|------|------|
| é¦–å­—èŠ‚æ—¶é—´ (TTFB) | 2.28s | ~50ms |
| é¡µé¢åŠ è½½ | 3.5s | 0.8s |

ä¸»è¦æå‡æ¥è‡ª CDN ç¼“å­˜ã€‚ä»£ç å±‚é¢å…¶å®å·²ç»æ²¡å•¥å¯ä¼˜åŒ–çš„äº†ï¼Œç“¶é¢ˆéƒ½åœ¨ç½‘ç»œå»¶è¿Ÿã€‚

## ä¸€äº›ç¢ç¢å¿µ

æ•´å¥—æµç¨‹è·‘ä¸‹æ¥ï¼Œæœ€çˆ½çš„æ˜¯çœŸçš„ä¸ç”¨æ“å¿ƒéƒ¨ç½²äº†ã€‚å†™å®Œæ–‡ç« ï¼Œcommit + pushï¼Œç­‰ä¸ªå‡ åç§’ï¼Œåˆ·æ–°é¡µé¢å°±èƒ½çœ‹åˆ°æ›´æ–°ã€‚

å½“ç„¶ä¹Ÿæœ‰ä¸çˆ½çš„åœ°æ–¹ã€‚Hugo çš„æ¨¡æ¿è¯­æ³•ï¼ˆGo Templateï¼‰ç”¨èµ·æ¥ä¸å¤ªé¡ºæ‰‹ï¼Œæ–‡æ¡£ä¹Ÿæ¯”è¾ƒæ•£ã€‚ä¸è¿‡å¿å¿å°±å¥½ï¼Œæ¯•ç«Ÿä¸»é¢˜é…å¥½äº†åŸºæœ¬ä¸ç”¨æ”¹ã€‚

å¦‚æœä½ ä¹Ÿåœ¨æŠ˜è…¾åšå®¢ï¼Œå¸Œæœ›è¿™ç¯‡èƒ½æœ‰ç‚¹å¸®åŠ©ã€‚æœ‰é—®é¢˜å¯ä»¥ç•™è¨€ï¼Œçœ‹åˆ°ä¼šå›çš„ ğŸ‘‹
